## Python API Server

This is a simple auth server which uses Python's **Flask** web framework. It generates a `JWT` token using `RSA` algorithm. Here, I have used a sqllite database to store user information.

### Install required packages
`pip install -r requirements.txt`

### Start the Flask server
```bash
python main.py
```

### Usage
1. First create a user by sending a **POST** request in the endpoint
    -  `http://localhost:5000/user`
    The body of request is in the following format
    ```
    {
        "email": "test1@eamil.com",
        "name": "test1",
        "password": "test1"
       
    }
    ```
    - Example:
    ![login](./images/postman_create.JPG)

1. After creating user then the user can login by sending a **GET** request to this endpoint. ` http://localhost:5000/login` using the username and password. You can use [Postman](https://www.postman.com/) to do this.
    - Then it returns token in following format.
    ```
    {
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJwdWJsaWNfaWQiOiIxYjIzMjNmNS05N2U1LTQ2ZDItOTg2Yy1lYjRmMGE3MjdkZjcifQ.rzG8dYyKtQSJjiE3stp0ZhyHNKGrDbk6lex3unWoZLjAk9Gy2bmllVeXQE0eiJWtA3cu1conq7RTRyhuvKVeP_0cR8cG9j-_J9V3TsHOZj_f50EpyY6RLQWvSN25i5DtfA0A5pppLjjZutO9Qgy-AgVum7B4qeU6G_FwLkzgMLYHlLbEuwvvhIM0m3dI00MgbTU6Gj0tis3hIMUKQXZUJL9m4NXbGx3j3kMihI8HLQVV9anzHK18Om-Rk7AOOyrjG490RFH9TXBF4sIDFy5N9CccB1dKfINVRCfjeF0FVajoneSUQWrErQgvqX5PA1hnxtXj0LO3gZqIZtxQIfdxqg"
    }
    ```
    - Example:
    ![create_user](./images/login.PNG)

    - This token is required to access other functionalities of the API such as *getting user info*.

1. To get the user profile send **GET** request to `http://localhost:5000/user/profile` along with the header containing the token. 
    - Respose is shown in the following format. It returns the details of the user who have sent the request.
    ```
        {
        "user": {
            "email": "test1@eamil.com",
            "name": "test1"
                }
        }
    ```
    - Example
    ![get_user](./images/get_user.PNG)

### Code for generating and verifying token
The `jwks_helper.py` file contains the code for generating the private and public keys and also generating and verifying tokens.

The private and public keys are generated by using the following code.

```python
from jwcrypto import jwk
import jwt
from jwt import PyJWKClient
import json
def generate_key():
    key = jwk.JWK.generate(kty='RSA', size=2048, alg='RSA', use='enc', kid='12345')
    public_key = key.export_public()
    private_key = key.export_private()
    return private_key, public_key
```
This code returns a **JSON Web Key (JWK)** for private and public key.

### JWK and JWKS

For **JSON Web Key Sets(JWKS)** we have the following endpoint.
` http://localhost:5000/jwks`
The user must provide the token in the header to get the JWKS. The response of this endpoint is 
```
{
    "keys": {
        "alg": "RSA",
        "e": "AQAB",
        "kid": "12345",
        "kty": "RSA",
        "n": "znzjcDpdgJ-9bHH3KlDYoFMMsljvb8ZWjN4XXtK2nD8zmnpZDs7XVLlykS4opHClAlpIneXnDYTZswjLwyr_4z72Mp6nIZHpgkZ9t8fozgUJbNmwCZwGNCdBScCSwO67tefdeUHRq3-2ZqOCWJC8X6UfhAgcJQIBgJpQljZ9HTcbcnRrTymkzMd19VLC3hncoL9KSfZ2NH-lmUwLZv4FQXMfjlKPDp-fsc2TCKYAToLFAUAWVPfQMhTEJlrFF19ykYsBDyg-M83Onz_h1z40q0-ihEovWmGgkzet6Q5OgqKT7JPdkOr-f-GT4RhFuLV5aMoVyYpUJiuljt8M6MMUZw",
        "use": "enc"
    }
}
```

It contains a set of JWK which is used to decode the token and retrive the message.

